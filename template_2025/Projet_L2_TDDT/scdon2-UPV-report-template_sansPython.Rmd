---
title: "Rapport de groupe des UE \\newline  Bases de donn√©es + Sciences des Donn√©es 2"
author: ""
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  pdf_document:
    fig_caption: yes
    keep_md: yes
    keep_tex: yes
    md_extensions: +raw_attribute
    number_sections: yes
    pandoc_args:
    - --top-level-division="chapter"
    - --bibliography="references.bib"
    template: template.tex
    toc: yes
    toc_depth: 1
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
  word_document:
    fig_caption: yes
    number_sections: yes
    pandoc_args: 
    - --top-level-division="chapter"
    - --to="odt+native_numbering"
    toc: yes
    toc_depth: '2'
toc-title: "Table des mati√®res"
bibliography: references.bib
coursecode: TV15MI-TV25MI
csl: iso690-author-date-fr-no-abstract.csl
Acknowledgements:
- Nos plus sinc√®res remerciements vont √† notre encadrant p√©dagogique pour les conseils
  avis√©s sur notre travail.
- Nous remercions aussi ...
biblio-style: elsarticle-harv
session: 2025
team: TDDT
groupeTD : TD1 
Abstract: |
  
  Notre projet vise √† analyser les performances financi√®res des entreprises fran√ßaises entre 2018 et 2022 √† partir des donn√©es du Registre National du Commerce et des Soci√©t√©s (RNCS). Nous cherchons √† comprendre quels sont les facteurs qui influencent la rentabilit√© des entreprises et comment ces derni√®res √©voluent en fonction de leur secteur d‚Äôactivit√©. Plus pr√©cis√©ment, nous allons :
  - Comparer les performances des entreprises selon leur chiffre d'affaires et leur rentabilit√©.
  - √âtudier l‚Äôimpact de la fiscalit√© sur la profitabilit√© des entreprises.
  - Analyser l‚Äô√©volution des ventes, des stocks et des taxes pour identifier des tendances √©conomiques.
always_allow_html: True
---

```{r setup, include=FALSE}
# Param√®tres g√©n√©raux pour les chunks R
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
)

# D√©finir le miroir CRAN pour √©viter les erreurs lors de l'installation des packages
options(repos = c(CRAN = "https://cran.rstudio.com/"))

# Liste des packages n√©cessaires pour le projet
required_packages <- c(
  "DBI", "RMySQL", "knitr", "kableExtra", "dplyr", "ggplot2", "readr", "stringr", "sqldf"
)

# Installer les packages manquants
installed <- required_packages %in% rownames(installed.packages())
if (any(!installed)) {
  install.packages(required_packages[!installed])
}

# Charger tous les packages
lapply(required_packages, library, character.only = TRUE)

# Connexion √† la base de donn√©es MySQL via MAMP (facultatif ici)
# Peut √™tre activ√©e dans un chunk s√©par√© si besoin.
# con <- dbConnect(
#   RMySQL::MySQL(),
#   user = "root",
#   password = "root",
#   dbname = "projet_L_2",
#   host = "127.0.0.1",
#   port = 8889,
#   socket = "/Applications/MAMP/tmp/mysql/mysql.sock"
# )



```



# Introduction {.label:s-intro}

## Pr√©sentation du projet

Les donn√©es financi√®res des entreprises jouent un r√¥le crucial dans la compr√©hension de leur sant√© √©conomique. Ce projet se concentre sur l'analyse des performances financi√®res des entreprises fran√ßaises entre 2018 et 2022, en utilisant les donn√©es fournies par le Registre National du Commerce et des Soci√©t√©s (RNCS).


\bigskip

\begin{itemize}[label=$\circ$]
    \item \textbf{Comparer les performances des entreprises selon leur chiffre d'affaires et leur rentabilit√©.}
    \item \textbf{√âtudier l‚Äôimpact de la fiscalit√© sur la profitabilit√© des entreprises.}
    \item \textbf{Analyser l‚Äô√©volution des ventes, des stocks et des taxes pour identifier des tendances √©conomiques.}
\end{itemize}


\medskip 

## Responsabilit√©s et composition de l‚Äô√©quipe


\medskip

MOUTCHACHOU Lydia : √âtudiant n¬∞22212656

IBNMTAR Hazem : √âtudiant n¬∞22309227

BERETTI--PRENANT Esteban : √âtudiant n¬∞22208752

VAROL Serdar : √âtudiant n¬∞22009668




\bigskip
## Objectifs et questions de recherche

Notre projet vise √† analyser les performances financi√®res des entreprises fran√ßaises entre 2018 et 2022. Pour ce faire, nous allons examiner plusieurs facteurs qui pourraient influencer la rentabilit√© des entreprises. Les questions sp√©cifiques que nous allons aborder sont les suivantes :

\medskip

 **Comparaison de la rentabilit√© par rapport au chiffre d'affaires :**

 a. Comment la rentabilit√© varie-t-elle en fonction de la taille de l'entreprise ?

 b. Y a-t-il une diff√©rence notable entre les entreprises qui ont recours au refinancement et celles qui n'en ont pas besoin ?
 
 
 **Comparaison de la rentabilit√© par rapport au chiffre** 

 a. La rentabilit√© des entreprises diff√®re-t-elle selon la ville o√π elles sont implant√©es ?

 b. Les entreprises qui exportent leurs produits ou services sont-elles plus rentables que celles qui op√®rent uniquement sur le march√© national ?
 
 
 
  **Impact fiscal et sectoriel :**

 a. Quel est l'impact des taxes sur la rentabilit√© des entreprises ?

 b. Comment la rentabilit√© varie-t-elle selon le secteur d'activit√© des entreprises ?


 **√âvolution temporelle :**

 a. Comment la rentabilit√© des entreprises a-t-elle √©volu√© entre 2012 et 2016 ?

 b. Peut-on identifier des tendances sp√©cifiques ou des p√©riodes de croissance/d√©clin dans les performances financi√®res des entreprises ?


\medskip
En r√©pondant √† ces questions, nous esp√©rons identifier les principaux facteurs influen√ßant la rentabilit√© des entreprises fran√ßaises et fournir des insights pr√©cieux pour les d√©cideurs √©conomiques et les gestionnaires d'entreprises.



# Base de donn√©es

## Provenance des donn√©es
<!-- serdar varol -->

Les donn√©es utilis√©es dans ce projet proviennent du jeu de donn√©es Kaggle :
\medskip

\begin{itemize}[label=$\circ$]
  \item \textnormal{\textbf{Profit and loss \- Ontology.csv :} Contient les comptes de r√©sultat de 100 000 entreprises fran√ßaises, avec des informations d√©taill√©es sur les revenus, les d√©penses et les b√©n√©fices.}
  
  \item \textnormal{\textbf{APE\_Fusion.csv :} Utilise le code APE pour classer les entreprises selon leur secteur d‚Äôactivit√©, permettant des comparaisons sectorielles pr√©cises.}

  \item \textnormal{\textbf{Data\_Kaggle.csv :} Fournit des donn√©es globales sur les entreprises, incluant les ventes, les stocks et les taxes, permettant d'analyser l‚Äô√©volution des performances financi√®res sur plusieurs ann√©es.}
\end{itemize}

\medskip

\textit{Lien vers les donn√©es :} \href{https://www.kaggle.com/datasets/briaclg/financial-data-of-french-compagnies/data?select=Profit+and+loss+-+Onthology.csv}{Kaggle Dataset}





## Descriptif des tables
\bigskip

### Table 1: APE_Fusion.csv
\begin{table}[H]
\centering
\scriptsize
\begin{tabular}{|p{3.2cm}|p{1.2cm}|p{7.5cm}|p{2.5cm}|}
\hline
\textbf{Nom colonne} & \textbf{Type} & \textbf{Signification} & \textbf{Caract√©ristique} \\
\hline
Unname d: 0 & int & Index ou identifiant de ligne (peut √™tre ignor√© dans l'analyse) & \\
\hline
ape & object & Code APE complet de l'activit√© principale de l'entreprise & Cl√© primaire \\
\hline
ape\_name & object & Nom ou description de l'activit√© correspondant au code APE & \\
\hline
ape\_len & int & Longueur du code APE, indiquant le nombre de caract√®res qu'il contient & \\
\hline
ape\_cat0 & int & Premier niveau du code APE (division), compos√© des 2 premiers chiffres & \\
\hline
ape\_cat1 & float & Deuxi√®me niveau du code APE (groupe), compos√© des 3 premiers chiffres & \\
\hline
ape\_cat2 & float & Troisi√®me niveau du code APE (classe), compos√© des 4 premiers chiffres & \\
\hline
ape\_cat3 & object & Dernier niveau du code APE (sous-classe) & \\
\hline
Libell√© & object & Description du secteur d'activit√© auquel appartient le code APE & \\
\hline
Code & object & Code alphab√©tique suppl√©mentaire associ√© au secteur d'activit√© & \\
\hline
\end{tabular}
\footnotesize
\label{tab:ape_description}
\end{table}



### Table 2 : Profit and loss - Ontology.csv

\begin{table}[H]
\centering
\scriptsize
\begin{tabular}{|p{4cm}|p{2cm}|p{9cm}|}
\hline
\textbf{Nom colonne} & \textbf{Type} & \textbf{Signification} \\
\hline
Columns\_(FR/EN) & varchar & Colonnes des √©tats financiers en fran√ßais et en anglais \\
\hline
Description (FR) & varchar & Explication de ce que chaque colonne repr√©sente \\
\hline
Liasse (Id) & int & Identifiant unique des colonnes dans la base INPI \\
\hline
Calcul & varchar & M√©thode de calcul pour certaines valeurs dans les colonnes \\
\hline
\end{tabular}
\normalsize
\end{table}


### Table 3 : Data_Kaggle.csv

\scriptsize
\begin{longtable}{|p{0.7cm}|p{12cm}|p{1.5cm}|}
\hline
\textbf{N\textdegree} & \textbf{Variable} & \textbf{Code} \\
\hline \endfirsthead
\hline \textbf{N\textdegree} & \textbf{Variable Nome} & \textbf{Nome de Colon} \\ \hline \endhead
1 & year & B \\
2 & Autres imp\^ots, taxes et versements assimil\'es & C \\
3 & Ventes de marchandises & D \\
4 & Production vendue biens & E \\
5 & Production vendue services & F \\
6 & Chiffres d\'affaires nets & G \\
7 & Production stock\'ee & H \\
8 & Production immobilis\'ee & I \\
9 & Subventions d\'exploitation & J \\
10 & Reprises sur amortissements et provisions, transfert de charges & K \\
11 & Autres produits & L \\
12 & Total des produits d\'exploitation & M \\
13 & Achats de marchandises (y compris droits de douane) & N \\
14 & Variation de stock (marchandises) & O \\
15 & Achats de mati\`eres premi\`eres et autres approvisionnements & P \\
16 & Variation de stock (mati\`eres premi\`eres et approvisionnements) & Q \\
17 & Autres achats et charges externes & R \\
18 & Imp\^ots, taxes et versements assimil\'es & S \\
19 & Salaires et traitements & T \\
20 & Charges sociales & U \\
21 & Autres charges & V \\
22 & Total des charges d\'exploitation & W \\
23 & R\'esultat d'exploitation & X \\
24 & B\'en\'efice attribu\'e ou perte transf\'er\'ee & Y \\
25 & Perte support\'ee ou b\'en\'efice transf\'er\'e & Z \\
26 & Produits financiers de participations & AA \\
27 & Produits des autres valeurs mobili\`eres et cr\'eances de l\'actif immobilis\'e & AB \\
28 & Autres int\'er\^ets et produits assimil\'es & AC \\
29 & Reprises sur provisions et transferts de charges financier & AD \\
30 & Diff\'erences positives de change & AE \\
31 & Produits nets sur cessions de valeurs mobili\`eres de placement & AF \\
32 & Total des produits financiers & AG \\
33 & Dotations financi\`eres sur amortissements et provisions & AH \\
34 & Int\'er\^ets et charges assimil\'ees & AI \\
35 & Diff\'erences n\'egatives de change & AJ \\
36 & Charges nettes sur cessions de valeurs mobili\`eres de placement & AK \\
37 & Total des charges financi\`eres & AL \\
38 & R\'esultat financier & AM \\
39 & R\'esultat en cours avant imp\^ots & AN \\
40 & Produits exceptionnels sur op\'erations de gestion & AO \\
41 & Produits exceptionnels sur op\'erations en capital & AP \\
42 & Reprises sur provisions et transferts de charges exceptionnel & AQ \\
43 & Total des produits exceptionnels & AR \\
44 & Charges exceptionnelles sur op\'erations de gestion & AS \\
45 & Charges exceptionnelles sur op\'erations en capital & AT \\
46 & Dotations exceptionnelles aux amortissements et provisions & AU \\
47 & Total des charges exceptionnelles & AV \\
48 & R\'esultat exceptionnel & AW \\
49 & Participation des salari\'es aux r\'esultats de l\'entreprise & AX \\
50 & Imp\^ots sur les b\'en\'efices & AY \\
51 & Total des produits & AZ \\
52 & Total des charges & BA \\
53 & B\'en\'efices ou perte (Total des produits - Total des charges) & BB \\
54 & Imp\^ots diff\'er\'es (compte de r\'esultat) & BC \\
55 & R\'esultat net des soci\'et\'es mises en \'equivalence & BD \\
56 & R\'esultat net des entreprises int\'egr\'ees & BE \\
57 & R\'esultat Groupe (R\'esultat net consolid\'e) & BF \\
58 & Part des int\'er\^ets minoritaires (R\'esultat hors groupe) & BG \\
59 & R\'esultat net part du groupe (part de la soci\'et\'e m\`ere) & BH \\
60 & R\'emun\'eration d\'interm\'ediaires et honoraires (hors r\'etrocessions) & BI \\
61 & Location, charges locatives et de copropri\'et\'e & BJ \\
62 & Effectif moyen du personnel & BK \\
63 & Sous-traitance & BL \\
64 & Personnel ext\'erieur \`a l\'entreprise & BM \\
65 & R\'etrocessions d\'honoraires, commissions et courtages & BN \\
66 & Taxe professionnelle & BO \\
67 & Montant de la TVA. collect\'ee & BP \\
\hline
\end{longtable}
\normalsize
\scriptsize
\begin{longtable}{|p{0.7cm}|p{12cm}|p{1.5cm}|}
\hline
\textbf{N\textdegree} & \textbf{Variable} & \textbf{Code} \\
\hline \endfirsthead
\hline \textbf{N\textdegree} & \textbf{Variable Nome} & \textbf{Nome de Colon} \\ \hline \endhead
68 & Total TVA. d\'eductible sur biens et services & BQ \\
69 & Dividendes & BR \\
70 & siren & BS \\
\hline
\end{longtable}
\normalsize

\newpage
## Mod√®les MCD et MOD
<!-- serdar varol -->
<!-- esteban beretti -->
- Pour le MCD, inclure une image r√©alis√©e avec le logiciel Mocodo \href{https://www.mocodo.net/?mcd=eNqNksFu2zAMhu96Ch0dQAOW7Zab67ZK2zTL4ixtcjEUh14FOJKhyFm3N_J9b-AX62_HaOMEAwb4Ay1SIvlLjMvNQRmvrRnxWDsywe3DQPD43R296MwRCw9Wu7AgMRzy2Ka6rnxdieGUwyfJsKMZNUsBpmrX2kj5z50ddvZLZ7-Kid5QniNNZLfEMoXyTTWUC7OM3EWpLpggiq2j0BgixhyldLClQ8uC945wnPkQ0u1_D49auYJfk7E7fdwjeNNKYfde5WJhf8GBZtlM_SYXvSj380w_b7tq_Ena3lNX5KzT05u9DcE1kOAePIIp-AZm4DuYM3bzWljnyc2c3ZbaX9btAv3CSzJbR01Il_97pi-g12sMFuAHWIIn8AxWYC24_PNp9cxGDN9Z5pMsEiLlA5gAiJUQKyFWQuwYlzG-AhHApaxvBF8h-WrNIrsrvNroXHtqH79Z05z2Ze5VTxm_nA1xoVX866VO0_bEz-uqdfqEXovcavxhQgIpe7FMG2VSTS6Qy4H48Ktm6hK9K-q_fh_Ip7OEKRVNNkN5ML5DbGExcUlxbHkfjCcDcXSlbc_wPGLXVV2Zusp0SklBGI5gPB2wN-SeTJ4=}{https://www.moc\\odo.net} telle que celle visible sur la Figure$~$\ref{MCD} ci-dessous :
  
![MCD](image_sql/MCD.png){#MCD width=8cm height=10cm }  

- Pour le MOD, inclure les images r√©alis√©e avec le logiciel MySQL, telle que celles visible sur la Figure ci-dessous :

![MOD](image_sql/mssql_1.png){#M0D width=10cm height=5cm}





![MOD Table Total](image_sql/mcd_totat.png){#MOD_total width=15cm height=5cm}


![Societe Table](image_sql/societe.png){#Societe width=15cm height=5cm}


![Charge Chiffre](image_sql/charge_chiffre.png){#charge_chiffre width=15cm height=5cm}


![Chiffre affaire](image_sql/chiffre_affaire.png){#Chiffre_affaire width=15cm height=5cm}


![Compte de R√©sultat](image_sql/compte_resulta.png){#compte_resulta width=15cm height=5cm}


![Produit Chiffre](image_sql/produit_chiffre.png){#produit_chiffre width=15cm height=5cm}


![Subvention](image_sql/subvention.png){#subvention width=15cm height=3cm}






\newpage

\bigskip
## Import des donn√©es 
<!-- hazem inbmtar -->
\bigskip

Dans un premier temps, les donn√©es ont √©t√© charg√©es dans R √† l'aide de la fonction $read\_csv()$.
Ensuite, afin de faciliter l'importation de ces donn√©es dans phpMyAdmin, nous avons proc√©d√© √†
un d√©coupage (slicing) de la base initiale en sept tables distinctes, chacune regroupant les
variables pertinentes pour son th√®me sp√©cifique.

\medskip

Par exemple, pour la table *"soci√©t√©"*, nous avons conserv√© uniquement les colonnes suivantes :
*"siren", "denomination", "postal_code", "town" et "ape".*

Ce processus a √©t√© appliqu√© √† chaque table en s√©lectionnant les attributs n√©cessaires, puis
nous avons limit√© chaque sous-table √† ses 300 premi√®res lignes afin de simplifier les tests
d‚Äôimportation.

\medskip

Enfin, les tables ont √©t√© export√©es au format CSV √† l‚Äôaide de la fonction $write\_csv$.

\medskip

Dans un premier temps, nous avions extrait les **300** premi√®res lignes de la base de donn√©es
globale. Toutefois, afin d'obtenir un √©chantillon plus √©quilibr√© et repr√©sentatif dans le
temps, nous avons modifi√© notre approche : nous avons s√©lectionn√© les **100 premi√®res** lignes
pour chaque ann√©e, de **2012** √† **2016.**

\medskip

Pour cela, nous avons utilis√© la biblioth√®que sqldf dans R, qui permet d'ex√©cuter des requ√™tes
SQL directement sur des data frames. Par exemple, pour extraire les donn√©es de l‚Äôann√©e 2012,
nous avons utilis√© la requ√™te suivante :

````{r, eval=FALSE, echo=TRUE}


annee_2012 <- sqldf("SELECT * FROM data_kaggle WHERE year = 2012")


````

\medskip

Cette commande retourne toutes les colonnes de la base data_kaggle pour les lignes dont
l‚Äôann√©e est √©gale √† 2012.

\medskip

Nous avons ensuite appliqu√© la m√™me m√©thode (voir le code\ref{codeR_slicing}) pour chaque ann√©e (**2013 √† 2016**), puis extrait les 100 premi√®res lignes de chaque sous-ensemble. Enfin, nous avons combin√© ces sous-ensembles
afin d‚Äôobtenir une table finale regroupant **500 lignes** (100 par ann√©e). Cette nouvelle table
est ainsi mieux structur√©e pour les futures analyses et pourra √™tre import√©e dans phpMyAdmin
pour les √©tapes suivantes de notre projet.

\medskip

Lors de l‚Äôimportation de donn√©es sur phpMyAdmin, on a rencontr√© un petit probl√®me : la colonne
√©tait trop longue pour √™tre ins√©r√©e dans la table. Du coup, on a modifi√© simplement le nom de
la colonne. Elle √©tait : **¬´ Produits des autres valeurs mobili√®res et cr√©ances de l‚Äôactif immobilis√© ¬ª ** 
et on l‚Äôa chang√©e pour : **¬´ Produits des autres valeurs mobili√®res ¬ª**.

\medskip

   Cette commande retourne toutes les colonnes de la base data_kaggle pour les lignes dont l‚Äôann√©e est **√©gale √† 2012**.
Nous avons ensuite appliqu√© la m√™me m√©thode pour chaque ann√©e (2013 √† 2016), puis extrait **les 100 premi√®res lignes** de chaque sous-ensemble. Enfin, nous avons combin√© ces sous-ensembles afin d‚Äôobtenir une **table finale regroupant 500 lignes (100 par ann√©e)**. Cette nouvelle table est ainsi mieux structur√©e pour les futures analyses et pourra √™tre **import√©e dans phpMyAdmin** pour les √©tapes suivantes de notre projet.

\newpage





\newpage

## Requ√™tes r√©alis√©es


Pour chaque requ√™te, l'exprimer en langage naturel puis en SQL. Puis donner le r√©sultat obtenu (ou un extrait) et expliquer ce r√©sultat.

L'objectif est de varier le type de requ√™tes et de r√©pondre √† votre probl√©matique initiale.


1) Pour comperer et trouver selon leur code postal 
<!-- serdar varol -->


```{sql,eval=FALSE,echo=TRUE,}

SELECT 
    LEFT(postal_code, 2) AS departement,
    COUNT(*) AS nombre_entreprises
FROM 
    societe
WHERE 
    postal_code IS NOT NULL
GROUP BY 
    departement
ORDER BY 
    nombre_entreprises DESC;


```


![Code postal](image_sql/sql_1_Serdar.png){ width=5cm height=10cm}

\newpage

```{sql,eval=FALSE,echo=TRUE,}
SELECT 
    s.siren,
    s.denomination,
    s.postal_code,
    cr.`Chiffres d'affaires nets` AS chiffre_affaires_net
FROM 
    societe s
JOIN 
    compte_resultat cr ON s.siren = cr.siren
WHERE 
    LEFT(s.postal_code, 2) = '44';



```

![Code postal](image_sql/sql_2_serdar.png){ width=10cm height=10cm}










# Mat√©riel et M√©thodes

## Logiciels

Nous avons utilis√© ces logiciels lors de la r√©alisation de notre projet :


  - Pretraitment : Libre Office
  - Stocker Base Donn√©e : Mysql /MAMP
  - Traitment statistique et ecrit: R
  - Correction/ replacement:  Regex
  - Version control : GitHUB
  - L'IA : OpenAI et MISTRAL
  


\bigskip

Voici lien de github notre projet :  \href{https://github.com/serdarvarl/Project_DataBase_FR.git}{TDDT github}
 




## Mod√©lisation statistique



<http://biostatisticien.eu/springeR/livreR.pdf>


# Analyse et R√©sultats

## **Comparer les cat√©gories d'entreprises en fonction des Chiffres d'affaires nets**

<!-- lydia Moutchachou -->

\bigskip
**Variables :** Chiffres d‚Äôaffaires nets , cat√©gories (Effectif moyen du personnel)

#### Les cat√©gories d‚Äôentreprises :
\bigskip
\scriptsize
\begin{quote}
\textit{L‚Äôarticle 51 de la loi n¬∞2008-776 du 4 ao√ªt 2008 de modernisation de l‚Äô√©conomie (\textbf{LME}) d√©termine, pour les besoins de l‚Äôanalyse statistique, un classement des entreprises en quatre cat√©gories : les microentreprises, les petites et moyennes entreprises (\textbf{PME}), les entreprises de taille interm√©diaire (\textbf{ETI}) et les grandes entreprises.\\ \\Le d√©cret n¬∞ 2008-1354 du 18 d√©cembre 2008 pr√©cise les crit√®res permettant de d√©terminer l‚Äôappartenance √† une cat√©gorie d'entreprises.}
\end{quote}
\normalsize

\begin{itemize}[label=$\circ$]
  \item \textnormal{ \textbf{La microentreprise} est une entreprise dont l'effectif est inf√©rieur √† 10 personnes et dont le chiffre d'affaires ou le total du bilan annuel n'exc√®de pas 2 millions d'euros}
\item \textnormal{ \textbf{la PME} est une entreprise dont l‚Äôeffectif est inf√©rieur √† 250 personnes
et dont le chiffre d‚Äôaffaires annuel n'exc√®de pas 50 millions d'euros ou
dont le total de bilan n'exc√®de pas 43 millions d'euros }
\item \textnormal{\textbf{L'ETI}, entreprise de taille interm√©diaire, est une entreprise qui n'appartient pas √† la cat√©gorie des PME, dont l‚Äôeffectif est inf√©rieur √† 5000 personnes et dont le chiffre d'affaires annuel n'exc√®de pas 1 500 millions d'euros ou dont le total de bilan n'exc√®de pas 2 000 millions d'euros}
\item \textnormal{\textbf{La grande entreprise} est une entreprise qui ne peut pas √™tre class√©e
dans les cat√©gories pr√©c√©dentes}
\end{itemize}
````{r pretraitment_lydia, eval=TRUE,echo=FALSE}

#üü¢ Lire le fichier CSV

library(readr)
data_kaggle <- read_csv("csv/data_kaggle.csv")

#üü¢ extraire information des colonnes : 

library(dplyr)

kaggle_new <- data_kaggle %>%
  select(siren, ape, `Effectif moyen du personnel`, `Chiffres d‚Äôaffaires nets`, year)

#head(kaggle_new) # verifier les noms des colonnes 

#üü¢ suprimes toutes le ligne ou il y'a au moins une valeur manquante 

kaggle_new <- na.omit(kaggle_new)

#üü¢ S√©parer les donn√©es par ann√©e

kaggle_2012 <- kaggle_new %>% filter(year == 2012)
kaggle_2013 <- kaggle_new %>% filter(year == 2013)
kaggle_2014 <- kaggle_new %>% filter(year == 2014)
kaggle_2015 <- kaggle_new %>% filter(year == 2015)
kaggle_2016 <- kaggle_new %>% filter(year == 2016)


#üü¢ V√©rifier les premi√®res lignes de chaque tableau

#head(kaggle_2012)  # Affiche les 6 premi√®res lignes du tableau de 2012
#head(kaggle_2013)  # Affiche les 6 premi√®res lignes du tableau de 2013
#head(kaggle_2014)  # Affiche les 6 premi√®res lignes du tableau de 2014
#head(kaggle_2015)  # Affiche les 6 premi√®res lignes du tableau de 2015
#head(kaggle_2016)  # Affiche les 6 premi√®res lignes du tableau de 2016


#üü¢ Renommer la colonne pour √©viter les caract√®res sp√©ciaux
colnames(kaggle_2012)[colnames(kaggle_2012) == "Chiffres d‚Äôaffaires nets"] <- "Chiffres_d_affaires_nets"
colnames(kaggle_2013)[colnames(kaggle_2013) == "Chiffres d‚Äôaffaires nets"] <- "Chiffres_d_affaires_nets"
colnames(kaggle_2014)[colnames(kaggle_2014) == "Chiffres d‚Äôaffaires nets"] <- "Chiffres_d_affaires_nets"
colnames(kaggle_2015)[colnames(kaggle_2015) == "Chiffres d‚Äôaffaires nets"] <- "Chiffres_d_affaires_nets"
colnames(kaggle_2016)[colnames(kaggle_2016) == "Chiffres d‚Äôaffaires nets"] <- "Chiffres_d_affaires_nets"

#üü¢ Cr√©er une fonction pour ajouter la colonne 'categorie'
ajouter_categorie <- function(data) {
  data %>%
    mutate(categorie = case_when(
      `Effectif moyen du personnel` < 10 & `Chiffres_d_affaires_nets` <= 2000000 ~ "Microentreprise",
      `Effectif moyen du personnel` < 250 & `Chiffres_d_affaires_nets` <= 50000000 ~ "PME",
      `Effectif moyen du personnel` < 5000 & `Chiffres_d_affaires_nets` <= 1500000000 ~ "ETI",
      TRUE ~ "Grande entreprise"
    ))
}

#üü¢ Appliquer cette fonction √† chaque tableau annuel
kaggle_2012 <- ajouter_categorie(kaggle_2012)
kaggle_2013 <- ajouter_categorie(kaggle_2013)
kaggle_2014 <- ajouter_categorie(kaggle_2014)
kaggle_2015 <- ajouter_categorie(kaggle_2015)
kaggle_2016 <- ajouter_categorie(kaggle_2016)

#üü¢ V√©rifier les premi√®res lignes de chaque tableau apr√®s modification

#head(kaggle_2012)
#head(kaggle_2013)
#head(kaggle_2014)
#head(kaggle_2015)
#head(kaggle_2016)


````

\newpage

### Test Statistique :  ANOVA

\medskip

#### **2012**

\medskip

````{r ,eval=TRUE,echo=FALSE}
#V√©rifier la structure des donn√©es de 2012
  #str(kaggle_2012) # s'assurer que les colonnes sont bien au bon format avant d'appliquer le test l'ANOVA

# Lancer l‚ÄôANOVA
  anova_result2012 <- aov(`Chiffres_d_affaires_nets` ~ categorie, data = kaggle_2012)

````

````{r,eval=TRUE,echo=FALSE}
# Afficher les r√©sultats
  summary(anova_result2012)

````

- D√©tail du test : 

- **Df** : Cela indique les degr√©s de libert√© pour chaque facteur (ici *categorie*) et les r√©sidus.  
Nous avons 2 degr√©s de libert√© pour les cat√©gories et 204 pour les r√©sidus.

- **Sum Sq** : La somme des carr√©s, qui mesure la variation expliqu√©e par chaque facteur (ici, la variation expliqu√©e par la cat√©gorie d‚Äôentreprise) et par les r√©sidus (erreur).

- **Mean Sq** : La moyenne des carr√©s, obtenue en divisant la somme des carr√©s par les degr√©s de libert√©. Cela permet d‚Äôavoir une id√©e de la variance.

- **F value** : Le rapport entre la variance expliqu√©e par les cat√©gories et la variance r√©siduelle (erreur).  
Un F √©lev√© (ici 817.9) indique qu'il existe une grande diff√©rence entre les groupes.

- **Pr(>F)** : La p-value associ√©e au test F. Elle est ici inf√©rieure √† 2e-16, ce qui est tr√®s significatif.

- **Test de Signification**  
La p-value obtenue est extr√™mement faible (< 2e-16), ce qui signifie que nous rejetons l'hypoth√®se nulle (H0) au seuil de signification de 5 % (0.05).  
En d'autres termes, il y a une diff√©rence statistiquement significative entre les moyennes des Chiffres d‚Äôaffaires nets des diff√©rentes cat√©gories d‚Äôentreprises.

- **Que signifie cette diff√©rence ?**   
Cela signifie que les entreprises de cat√©gories diff√©rentes (par exemple, Microentreprise, PME, ETI, Grande entreprise) ont des Chiffres d‚Äôaffaires nets tr√®s diff√©rents.  
Il est donc √©vident qu'une entreprise de type *Microentreprise* n'a pas la m√™me performance en termes de chiffre d'affaires net qu'une PME ou une Grande entreprise.

- **R√©sum√©**  
En 2012, les Chiffres d‚Äôaffaires nets varient de mani√®re significative en fonction de la cat√©gorie d'entreprise.  
Cela signifie que les Microentreprises ne g√©n√®rent pas le m√™me chiffre d'affaires net que les PME ou les Grandes entreprises.


\newpage



#### **2013**

\medskip

````{r ,eval=TRUE,echo=FALSE}
#V√©rifier la structure des donn√©es de 2013
#str(kaggle_2013) # s'assurer que les colonnes sont bien au bon format avant d'appliquer le test l'ANOVA
          
#Lancer l‚ÄôANOVA
anova_result2013 <- aov(`Chiffres_d_affaires_nets` ~ categorie, data = kaggle_2013)
          
````

````{r,eval=TRUE,echo=FALSE}
# Afficher les r√©sultats
summary(anova_result2013)

````

\medskip

- D√©tails du test  :

\medskip
    
- **Df** (degr√©s de libert√©) : categorie : 2 (ce qui correspond √† 3 cat√©gories de classification : Microentreprise, PME, Grande entreprise)
 
- **Residuals** : 1102 (le nombre de donn√©es restantes apr√®s l application des cat√©gories)


- **Sum Sq** (somme des carr√©s) : Pour la variable categorie, la somme des carr√©s est de 2.160e+17. Cela repr√©sente la variation expliqu√©e par les diff√©rences entre les cat√©gories.Pour les r√©sidus, la somme des carr√©s est de 2.423e+17. Cela repr√©sente la variation non expliqu√©e, c est-√†-dire celle qui est attribu√©e aux erreurs ou √† des facteurs non pris en compte dans le mod√®le.

- **Mean Sq** (moyenne des carr√©s) : Pour categorie, la moyenne des carr√©s est de 1.080e+17. Pour les r√©sidus, la moyenne des carr√©s est de 2.198e+14.

- **F value** : La valeur de F est de 491.2, ce qui est tr√®s √©lev√©. Cela indique une forte variation entre les cat√©gories par rapport √† la variation r√©siduelle.

- **Pr(>F)** : La valeur p associ√©e √† ce test est < 2e-16, ce qui est tr√®s inf√©rieur √† 0.05. Cela signifie que les diff√©rences entre les cat√©gories sont statistiquement significatives.


- **Interpr√©tation des r√©sultats** : Le test ANOVA montre que la variable "Chiffres d'affaires nets" varie de mani√®re significative en fonction de la cat√©gorie dentreprise (Microentreprise, PME, Grande entreprise). La valeur p tr√®s faible (< 2e-16) nous permet de conclure que les moyennes des chiffres daffaires nets sont significativement diff√©rentes selon les cat√©gories dentreprises.En dautres termes, il y a des diff√©rences importantes dans les chiffres daffaires nets entre les diff√©rentes cat√©gories d entreprises (Microentreprises, PME et Grandes entreprises) pour lann√©e 2013.



- **Conclusion** : Le test ANOVA r√©v√®le que la taille de l entreprise (cat√©gorie) est un facteur qui a un impact important sur le chiffre d affaires net des entreprises pour lann√©e 2013.

\newpage

 *Representation graphique boite a moustaches : *

````{r ,eval=TRUE,echo=FALSE, fig.width=5, fig.heigth= 4}

 ggplot(kaggle_2013, aes(x = categorie, y = Chiffres_d_affaires_nets, fill = categorie)) +
            geom_boxplot() +
            labs(
              title = paste(strwrap("Bo√Æte √† moustaches des Chiffres d'affaires nets selon la cat√©gorie (2013)", width = 40), collapse = "\n"),
              x = "Cat√©gorie d'entreprise",
              y = "Chiffres d'affaires nets"
            ) +
            theme_minimal() +
            theme(
              plot.title = element_text(hjust = 0.5, face = "bold"),
              axis.text.x = element_text(angle = 45, hjust = 1)
            )


````


#### **2014**


````{r ,eval=TRUE,echo=FALSE}
#V√©rifier la structure des donn√©es de 2013
#str(kaggle_2013) # s'assurer que les colonnes sont bien au bon format avant d'appliquer le test l'ANOVA
          
#Lancer l‚ÄôANOVA
anova_result2014 <- aov(`Chiffres_d_affaires_nets` ~ categorie, data = kaggle_2014)
          
````

````{r,eval=TRUE,echo=FALSE}
# Afficher les r√©sultats
summary(anova_result2014)
````



 - D√©tails du test :

\medskip

- **Df (degr√©s de libert√©)** : La variable 'categorie' a 3 degr√©s de libert√©, ce qui correspond √† 4 cat√©gories : Microentreprise, PME, ETI, et Grande entreprise. Les r√©sidus ont 2716 degr√©s de libert√©, correspondant au nombre de donn√©es restantes apr√®s l'application des cat√©gories.

- **Sum Sq (somme des carr√©s)** : Pour la variable 'categorie', la somme des carr√©s est de 5.252e+19, ce qui repr√©sente la variation expliqu√©e par les diff√©rences entre les cat√©gories. Pour les r√©sidus, la somme des carr√©s est de 4.253e+19, repr√©sentant la variation non expliqu√©e par le mod√®le.

- **Mean Sq (moyenne des carr√©s)** : La moyenne des carr√©s pour 'categorie' est de 1.751e+19, La moyenne des carr√©s pour les r√©sidus est de 1.566e+16.

- **F value** : La valeur de F est tr√®s √©lev√©e, √† 1118, ce qui montre qu'il existe une grande diff√©rence entre les groupes par rapport √† la variation r√©siduelle. Une valeur de F √©lev√©e signifie que les diff√©rences entre les groupes sont beaucoup plus grandes que la variation interne √† chaque groupe.

- **Pr(>F)** : La valeur p associ√©e √† ce test est inf√©rieure √† 2e-16, ce qui est bien en dessous du seuil de 0.05.  Cela montre que les diff√©rences entre les cat√©gories sont tr√®s significatives, ce qui nous permet de rejeter l'hypoth√®se nulle selon laquelle il n'y a pas de diff√©rence entre les cat√©gories.

- **Interpr√©tation des r√©sultats** : Le test ANOVA montre que la variable 'Chiffres_d_affaires_nets' varie de mani√®re significative en fonction de la cat√©gorie d'entreprise (Microentreprise, PME, ETI, Grande entreprise). La valeur p tr√®s faible (< 2e-16) indique que les moyennes des chiffres d'affaires nets sont statistiquement diff√©rentes selon les cat√©gories d'entreprises. Cela signifie que l'appartenance √† une cat√©gorie d'entreprise (Microentreprise, PME, ETI, Grande entreprise) a un impact significatif sur les chiffres d'affaires nets pour l'ann√©e 2014.

- **Conclusion** : Le test ANOVA confirme que la taille de l'entreprise (cat√©gorie) influence le chiffre d'affaires net des entreprises en 2014. En comparant les moyennes des diff√©rentes cat√©gories (Microentreprises, PME, ETI, et Grandes entreprises), on peut dire qu'il y a des diff√©rences marqu√©es dans les chiffres d'affaires entre ces groupes.

 - Representation graphique boite a moustaches : 
    

````{r ,eval=TRUE,echo=FALSE, fig.width=5, fig.heigth= 4}
    
    
    ggplot(kaggle_2014, aes(x = categorie, y = Chiffres_d_affaires_nets, fill = categorie)) +
      geom_boxplot() +
      labs(
        title = paste(strwrap("Bo√Æte √† moustaches des Chiffres d'affaires nets selon la cat√©gorie (2014)", width = 40), collapse = "\n"),
        x = "Cat√©gorie d'entreprise",
        y = "Chiffres d'affaires nets"
      ) +
      theme_minimal() +
      theme(
        plot.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1)
      )

````
\newpage

#### **2015**


````{r, eval=TRUE,echo=FALSE}
          
#  V√©rifier la structure des donn√©es de 2015
#str(kaggle_2015) # s'assurer que les colonnes sont bien au bon format avant d'appliquer le test l'ANOVA
          
# Lancer l‚ÄôANOVA
  anova_result2015 <- aov(`Chiffres_d_affaires_nets` ~ categorie, data = kaggle_2015)

````
        
````{R,eval=TRUE,echo=FALSE}

#Afficher les r√©sultats
summary(anova_result2015)

````
          

  
 - D√©tails du test :

\medskip

- **Df (Degr√©s de libert√©)** : Le facteur "categorie" a 3 degr√©s de libert√©, et les r√©sidus (erreurs) ont 9588 degr√©s de libert√©. Cela refl√®te le nombre de groupes compar√©s (les diff√©rentes cat√©gories d'entreprises) et la quantit√© de donn√©es disponibles pour les erreurs.

- **Sum Sq (Somme des carr√©s)** : La somme des carr√©s repr√©sente la variation dans les donn√©es. La variation expliqu√©e par la cat√©gorie d'entreprise est de 2.864e+19, tandis que la variation r√©siduelle (l'erreur) est de 3.293e+19.

- **Mean Sq (Moyenne des carr√©s)** : La moyenne des carr√©s est calcul√©e en divisant la somme des carr√©s par les degr√©s de libert√©. Pour la cat√©gorie, la moyenne des carr√©s est de 9.546e+18, et pour les r√©sidus, elle est de 3.434e+15.

- **F value** : Le F-value est le rapport entre la variation expliqu√©e par les cat√©gories et celle des r√©sidus. Ici, il est de 2780, ce qui est tr√®s √©lev√©, indiquant une diff√©rence marqu√©e entre les groupes.

- **Pr(>F)** : La p-value associ√©e au test F. Elle est inf√©rieure √† 2e-16, ce qui est tr√®s significatif. Cela montre que la probabilit√© que les diff√©rences observ√©es soient dues au hasard est extr√™mement faible.

- **Test de Signification** : La p-value obtenue est extr√™mement faible (< 2e-16), ce qui signifie que l'hypoth√®se nulle (H0), qui stipule qu'il n'y a pas de diff√©rence entre les groupes, est rejet√©e. Ainsi, au seuil de 5 % de signification, nous concluons qu'il existe une diff√©rence statistiquement significative entre les moyennes des chiffres d‚Äôaffaires nets des diff√©rentes cat√©gories d‚Äôentreprises.

- **Que signifie cette diff√©rence ?** : Les entreprises de cat√©gories diff√©rentes (comme les Microentreprises, PME, ETI, et Grandes entreprises) ont des chiffres d'affaires nets tr√®s diff√©rents. Par exemple, une Microentreprise n'a clairement pas les m√™mes performances financi√®res qu'une PME ou une Grande entreprise.

- **R√©sum√©** : En 2015, les chiffres d‚Äôaffaires nets varient de mani√®re significative selon la cat√©gorie d'entreprise. Cela sugg√®re que les petites entreprises (comme les Microentreprises) g√©n√®rent beaucoup moins de chiffre d'affaires net compar√©es aux entreprises plus grandes.

  
````{r ,eval=TRUE,echo=FALSE, fig.width=5, fig.heigth= 4}
  #Cr√©er la bo√Æte √† moustaches : 

  #
  ggplot(kaggle_2015, aes(x = categorie, y = Chiffres_d_affaires_nets, fill = categorie)) +
    geom_boxplot() +
    labs(
      title = paste(strwrap("Bo√Æte √† moustaches des Chiffres d'affaires nets selon la cat√©gorie (2015)", width = 40), collapse = "\n"),
      x = "Cat√©gorie d'entreprise",
      y = "Chiffres d‚Äôaffaires nets"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      axis.text.x = element_text(angle = 45, hjust = 1)
    )

````



#### **2016**


````{r, eval=TRUE,echo=FALSE}
          
#  V√©rifier la structure des donn√©es de 2015
#str(kaggle_2015) # s'assurer que les colonnes sont bien au bon format avant d'appliquer le test l'ANOVA
          
# Lancer l‚ÄôANOVA
  anova_result2016 <- aov(`Chiffres_d_affaires_nets` ~ categorie, data = kaggle_2016)

````
        
````{R,eval=TRUE,echo=FALSE}

#Afficher les r√©sultats
summary(anova_result2016)

````
          

\medskip

- D√©tails du test :

\medskip

- **Df (Degr√©s de libert√©)** : Le facteur "categorie" a 3 degr√©s de libert√©, et les r√©sidus (erreurs) ont 1358 degr√©s de libert√©. Cela repr√©sente le nombre de groupes compar√©s (les diff√©rentes cat√©gories d'entreprises) et la quantit√© de donn√©es restantes pour l'erreur.

- **Sum Sq (Somme des carr√©s)** : La somme des carr√©s repr√©sente la variation dans les donn√©es. La variation expliqu√©e par la cat√©gorie d'entreprise est de 1.092e+19, tandis que la variation r√©siduelle (l'erreur) est de 2.460e+19.

- **Mean Sq (Moyenne des carr√©s)** : La moyenne des carr√©s est calcul√©e en divisant la somme des carr√©s par les degr√©s de libert√©. Pour la cat√©gorie, la moyenne des carr√©s est de 3.639e+18, et pour les r√©sidus, elle est de 1.812e+16.

- **F value** : Le F-value est le rapport entre la variation expliqu√©e par les cat√©gories et celle des r√©sidus. Ici, il est de 200.9, ce qui est relativement √©lev√©, indiquant une diff√©rence entre les groupes.

- **Pr(>F)** : La p-value associ√©e au test F. Elle est inf√©rieure √† 2e-16, ce qui est extr√™mement significatif. Cela montre que la probabilit√© que les diff√©rences observ√©es soient dues au hasard est tr√®s faible.

- **Test de Signification :** La p-value obtenue est extr√™mement faible (< 2e-16), ce qui signifie que l'hypoth√®se nulle (H0), qui stipule qu'il n'y a pas de diff√©rence entre les groupes, est rejet√©e. Ainsi, au seuil de 5 % de signification, nous concluons qu'il existe une diff√©rence statistiquement significative entre les moyennes des chiffres d‚Äôaffaires nets des diff√©rentes cat√©gories d‚Äôentreprises.

- **Que signifie cette diff√©rence ? :** Les entreprises de cat√©gories diff√©rentes (comme les Microentreprises, PME, ETI, et Grandes entreprises) ont des chiffres d'affaires nets tr√®s diff√©rents. Une Microentreprise n'a pas les m√™mes performances financi√®res qu'une PME ou une Grande entreprise.

- **R√©sum√©** : En 2016, les chiffres d‚Äôaffaires nets varient de mani√®re significative en fonction de la cat√©gorie d'entreprise. Cela sugg√®re que les petites entreprises (comme les Microentreprises) g√©n√®rent beaucoup moins de chiffre d'affaires net compar√©es aux entreprises plus grandes.

\medskip

- Repr√©sentation graphique (bo√Æte √† moustaches):

````{r ,eval=TRUE,echo=FALSE, fig.width=5, fig.heigth= 4}
#  Cr√©er la bo√Æte √† moustaches : 
  
  ggplot(kaggle_2016, aes(x = categorie, y = Chiffres_d_affaires_nets, fill = categorie)) +
    geom_boxplot() +
    labs(
      title = "Bo√Æte √† moustaches des Chiffres d‚Äôaffaires nets selon la cat√©gorie (2016)",
      x = "Cat√©gorie d'entreprise",
      y = "Chiffres d‚Äôaffaires nets"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, face = "bold"),
      axis.text.x = element_text(angle = 45, hjust = 1)
    )


````

\newpage

### Conclusion
\medskip
Dans cette analyse, nous avons examin√© les diff√©rences de chiffre d'affaires net entre les diff√©rentes cat√©gories d'entreprises **(Microentreprise, PME, ETI, Grande entreprise)** sur la p√©riode *2012-2016*. Les tests ANOVA ont permis de confirmer que les diff√©rences observ√©es sont statistiquement significatives, ce qui montre que la taille de l'entreprise a un impact notable sur ses performances √©conomiques.
\medskip
Les r√©sultats ont montr√© que les Microentreprises g√©n√®rent des chiffres d'affaires nettement inf√©rieurs √† ceux des PME et des Grandes entreprises. Les bo√Ætes √† moustaches ont illustr√© visuellement ces diff√©rences, renfor√ßant ainsi les conclusions des tests statistiques.
\medskip
En conclusion, cette analyse confirme que la taille de l'entreprise est un facteur d√©terminant dans ses r√©sultats √©conomiques. Ces r√©sultats peuvent √™tre utilis√©s pour guider des d√©cisions politiques et strat√©giques, notamment pour le soutien aux entreprises en fonction de leur taille.




\newpage

## **Analyse des subventions et du chiffre d'affaires**
<!-- esteban beretti -->
\medskip

L'objectif de cette section est de comprendre si les subventions re√ßues par les entreprises fran√ßaises ont un impact sur leur chiffre d'affaires.

Les montants des subventions et du chiffre d'affaires varient √©norm√©ment entre les entreprises : certaines ne re√ßoivent presque rien, d'autres ont des montants tr√®s √©lev√©s. Pour rendre les donn√©es plus lisibles et √©viter que quelques cas extr√™mes ne faussent les r√©sultats, on utilise une transformation logarithmique. Cela permet d'observer les tendances de mani√®re plus √©quilibr√©e et de voir si, proportionnellement, plus de subventions entra√Æne plus de chiffre d'affaires.

#### 1. Nettoyage et pr√©paration des donn√©es

\medskip

Nous avons utilis√© conncetion MySQL pour examiner cette party, voici le code R:

\medskip


\footnotesize
````{r,eval= TRUE, echo = TRUE, warning=FALSE, message=FALSE}

con <- dbConnect(
  MySQL(),
  user = "root",
  password = "root", # m√™me mot de passe cr√©√© plus haut
  dbname = "projet_L_2",
  host = "127.0.0.1",
  port = 8889
)

# V√©rifie imm√©diatement la connexion :
#dbListTables(con)

df <- dbGetQuery(con, "
SELECT
    s.siren,
    s.denomination,
    s.town,
    s.ape,
    a.ape_name,
    cr.year,
    cr.`Chiffres d‚Äôaffaires nets` AS chiffre_affaires,
    sb.`Subventions d‚Äôexploitation` AS subvention
FROM projet_L_2.societe s
JOIN projet_L_2.apegen a
  ON s.ape = a.ape
JOIN projet_L_2.compte_resultat cr
  ON s.siren = cr.siren
JOIN projet_L_2.subvention sb
  ON s.siren = sb.siren AND cr.year = sb.year
WHERE cr.`Chiffres d‚Äôaffaires nets` IS NOT NULL
  AND sb.`Subventions d‚Äôexploitation` IS NOT NULL
")
````
\normalsize

\newpage

```{r,eval= TRUE, echo = TRUE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)

# Nettoyage
df_clean <- df %>%
  mutate(
    chiffre_affaires = as.numeric(gsub("[^0-9]", "", chiffre_affaires)),
    subvention = as.numeric(gsub("[^0-9]", "", subvention))
  ) %>%
  filter(!is.na(chiffre_affaires) & !is.na(subvention))

# Cr√©ation des colonnes logarithmiques
df_log <- df_clean %>%
  filter(chiffre_affaires > 0, subvention > 0) %>%
  mutate(
    log_CA = log10(chiffre_affaires),
    log_subvention = log10(subvention)
  )

# R√©gression log-log
modele_log <- lm(log_CA ~ log_subvention, data = df_log)
summary(modele_log)
```
\normalsize

\newpage

### 2. Analyse univari√©e

 <!-- **Distribution des subventions re√ßues** -->

\medskip

```{r,eval= TRUE, echo = FALSE, warning=FALSE, message=FALSE,fig.width=4,fig.height=3}
ggplot(df_clean, aes(x = subvention)) +
  geom_histogram(fill = "darkorange", bins = 30) +
  labs(title = "Distribution des subventions re√ßues",
       x = "Montant des subventions",
       y = "Nombre d'entreprises")
```

> La majorit√© des entreprises re√ßoivent de petites subventions. Quelques-unes, plus rares, touchent des montants bien plus √©lev√©s.

<!-- **Distribution du chiffre d'affaires** -->

\medskip

```{r,eval= TRUE, echo = FALSE, warning=FALSE, message=FALSE,fig.width=4,fig.height=3}
ggplot(df_clean, aes(x = chiffre_affaires)) +
  geom_histogram(fill = "steelblue", bins = 30) +
  labs(title = "Distribution du chiffre d'affaires",
       x = "Chiffre d'affaires",
       y = "Nombre d'entreprises")
```

> Le chiffre d'affaires est aussi tr√®s variable, certaines entreprises r√©alisant plusieurs dizaines de millions d'euros.

\medskip

### 3. Analyse bivari√©e brute

\medskip

```{r,eval= TRUE, echo = FALSE, warning=FALSE, message=FALSE,fig.width=4,fig.height=3}
ggplot(df_clean, aes(x = subvention, y = chiffre_affaires)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Relation brute entre subventions et chiffre d'affaires",
       x = "Subvention",
       y = "Chiffre d'affaires")
```

> √Ä premi√®re vue, il n'y a pas de lien clair entre les subventions et le chiffre d'affaires. Le graphique montre beaucoup de dispersion, ce qui emp√™che une vraie lecture de tendance.

\medskip

#### 4. R√©gression log-log : Visualisation

\medskip

```{r,eval= TRUE, echo = FALSE, warning=FALSE, message=FALSE,fig.width=4,fig.height=3}
ggplot(df_log, aes(x = log_subvention, y = log_CA)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Relation log-log entre subventions et chiffre d'affaires",
       x = "log10(Subvention)",
       y = "log10(Chiffre d'affaires)")
```

> Une fois les donn√©es transform√©es en logarithme, une tendance appara√Æt : les entreprises qui re√ßoivent plus de subventions ont, en moyenne, un chiffre d'affaires plus √©lev√©. La relation est significative et le mod√®le indique qu'une augmentation de 10% des subventions correspond √† une hausse d'environ 4,5% du chiffre d'affaires.

\medskip

#### Conclusion

\medskip

En conclusion, m√™me si √† l'√©chelle brute le lien entre subventions et chiffre d'affaires n'est pas visible, la transformation log-log montre qu‚Äôil existe une **relation proportionnelle significative**. Cela signifie que les subventions peuvent avoir un impact positif mesurable sur le d√©veloppement √©conomique des entreprises, en particulier si l'on consid√®re les effets relatifs plut√¥t que les montants absolus. sans refinancement : Total des charges financi√®res = 0


\newpage











## **Analyser des entreprises en fonction de leur localisation g√©ographique** 
<!-- Serdar VAROL -->
\bigskip

L‚Äôobjectif de cette √©tude est d‚Äôanalyser des entreprises en France √† partir de donn√©es financi√®res entre 2012 et 2016. Nous avons examin√© **le chiffre d‚Äôaffaires net**, **le r√©sultat d‚Äôexploitation**. Des entreprises et a √©t√© examin√©e par **ann√©e** et par **region**. La base de donn√©es ne contenait que des codes postaux. Nous avons d‚Äôabord regroup√© les d√©partements puis les r√©gions en fonction des deux chiffres du code postal.Nous avons examin√© chaque ann√©e ind√©pendamment. 

\medskip

Dans ce chapite pour analyse univarie, nous allons presenter l'annes 2015 car l‚Äôann√©e avec le plus de donn√©es est 2015. Nous avons constat√© que les diff√©rences et les incoh√©rences dans la taille des donn√©es selon les ann√©es et les r√©gions constituaient un obstacle.

\medskip

![Pivot Table](image_sql/image_independant/count_region-ca.png){#Pivot width=10cm height=5cm}

\medskip

### Pr√©paration des donn√©es

\medskip

1) Un fichier CSV (cr√©√© par code R) contenant les donn√©es financi√®res de l‚Äôentreprise de 2012 √† 2016 a √©t√© utilis√©

\small
```{r,eval= TRUE, echo = FALSE, warning=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(stringr)

# 1. Rentabilit√© fonction
fonction_rentabilite <- function(resultat_exp, ca) {
  if (is.na(resultat_exp) || is.na(ca) || ca == 0) {
    return(NA)
  } else {
    return((resultat_exp ) / ca)
  }
}

# categorise rentabilite 
cat_rentabilite <- function(r) {
  if (is.na(r)) {
    return("Non num√©rique")
  } else if (r < 0) {
    return("En perte")
  } else if (r < 0.1) {
    return("Faible rentabilit√©")
  } else if (r < 0.3) {
    return("Rentabilit√© moyenne")
  } else {
    return("Haute rentabilit√©")
  }
}

#read data 
data_kaggle <- read_csv("csv/data_kaggle.csv")

# 2012 - 2016 filtre
data_subset <- data_kaggle %>%
  filter(year >= 2012, year <= 2016) %>%
  select(year,
         siren,
         resultat_exp = `R√©sultat d'exploitation`,
         ca = `Chiffres d‚Äôaffaires nets`,
         postal_code = postal_code)

# calcule rentabulite
data_subset$rentabilite <- apply(data_subset, 1, function(row) {
  resultat_exp <- as.numeric(row["resultat_exp"])
  ca <- as.numeric(row["ca"])
  return(fonction_rentabilite(resultat_exp, ca))
})

# categorise rentabilite posser dans la csv
data_subset$categorie_rentabilite <- sapply(data_subset$rentabilite, cat_rentabilite)

# ajouter code postal et department
data_subset$code_postal <- str_pad(as.character(data_subset$postal_code), 5, side = "left", pad = "0")
data_subset$departement <- substr(data_subset$code_postal, 1, 2)

# D√©partement -> R√©gion convertir
departement_to_region <- c(
  "01"="Auvergne-Rh√¥ne-Alpes", "02"="Hauts-de-France", "03"="Auvergne-Rh√¥ne-Alpes", 
  "04"="Provence-Alpes-C√¥te d'Azur", "05"="Provence-Alpes-C√¥te d'Azur", "06"="Provence-Alpes-C√¥te d'Azur",
  "07"="Auvergne-Rh√¥ne-Alpes", "08"="Grand Est", "09"="Occitanie", "10"="Grand Est", "11"="Occitanie",
  "12"="Occitanie", "13"="Provence-Alpes-C√¥te d'Azur", "14"="Normandie", "15"="Auvergne-Rh√¥ne-Alpes",
  "16"="Nouvelle-Aquitaine", "17"="Nouvelle-Aquitaine", "18"="Centre-Val de Loire", "19"="Nouvelle-Aquitaine",
  "2A"="Corse", "2B"="Corse", "21"="Bourgogne-Franche-Comt√©", "22"="Bretagne", "23"="Nouvelle-Aquitaine",
  "24"="Nouvelle-Aquitaine", "25"="Bourgogne-Franche-Comt√©", "26"="Auvergne-Rh√¥ne-Alpes",
  "27"="Normandie", "28"="Centre-Val de Loire", "29"="Bretagne", "30"="Occitanie",
  "31"="Occitanie", "32"="Occitanie", "33"="Nouvelle-Aquitaine", "34"="Occitanie", "35"="Bretagne",
  "36"="Centre-Val de Loire", "37"="Centre-Val de Loire", "38"="Auvergne-Rh√¥ne-Alpes", "39"="Bourgogne-Franche-Comt√©",
  "40"="Nouvelle-Aquitaine", "41"="Centre-Val de Loire", "42"="Auvergne-Rh√¥ne-Alpes",
  "43"="Auvergne-Rh√¥ne-Alpes", "44"="Pays de la Loire", "45"="Centre-Val de Loire", "46"="Occitanie",
  "47"="Nouvelle-Aquitaine", "48"="Occitanie", "49"="Pays de la Loire", "50"="Normandie",
  "51"="Grand Est", "52"="Grand Est", "53"="Pays de la Loire", "54"="Grand Est", "55"="Grand Est",
  "56"="Bretagne", "57"="Grand Est", "58"="Bourgogne-Franche-Comt√©", "59"="Hauts-de-France",
  "60"="Hauts-de-France", "61"="Normandie", "62"="Hauts-de-France", "63"="Auvergne-Rh√¥ne-Alpes",
  "64"="Nouvelle-Aquitaine", "65"="Occitanie", "66"="Occitanie", "67"="Grand Est", "68"="Grand Est",
  "69"="Auvergne-Rh√¥ne-Alpes", "70"="Bourgogne-Franche-Comt√©", "71"="Bourgogne-Franche-Comt√©",
  "72"="Pays de la Loire", "73"="Auvergne-Rh√¥ne-Alpes", "74"="Auvergne-Rh√¥ne-Alpes",
  "75"="√éle-de-France", "76"="Normandie", "77"="√éle-de-France", "78"="√éle-de-France",
  "79"="Nouvelle-Aquitaine", "80"="Hauts-de-France", "81"="Occitanie", "82"="Occitanie",
  "83"="Provence-Alpes-C√¥te d'Azur", "84"="Provence-Alpes-C√¥te d'Azur", "85"="Pays de la Loire",
  "86"="Nouvelle-Aquitaine", "87"="Nouvelle-Aquitaine", "88"="Grand Est", "89"="Bourgogne-Franche-Comt√©",
  "90"="Bourgogne-Franche-Comt√©", "91"="√éle-de-France", "92"="√éle-de-France", "93"="√éle-de-France",
  "94"="√éle-de-France", "95"="√éle-de-France", "971"="Guadeloupe", "972"="Martinique",
  "973"="Guyane", "974"="La R√©union", "976"="Mayotte"
)

# ajouter region
data_subset$departement <- as.character(data_subset$departement)
data_subset$region <- departement_to_region[data_subset$departement]

# save dernirer version csv
write_csv(data_subset, "csv/resulta_data_kaggle_2012_2016_order.csv")
#View(data_subset)
```
\normalsize

2) Les Variables sont utilise:

|  Variable |source   |
|---|---|
|Year  |Datakagle.csv   |
|Siren  |Datakagle.csv   |
|r√©sultat d'exploitation  |Datakagle.csv |
|chiffres d‚Äôaffaires nets  |Datakagle.csv   |
|code_postal  |Datakagle.csv   |
|rentabilite  |cr√©√©   |
|categorie_rentabilite  |cr√©√©    |
|Department  |cr√©√©    |
|region  |cr√©√©    |



\medskip

3) Cr√©ation d'une variable cat√©gorielle : La valeur de rentabilit√© est divis√©e dans les classes suivantes :

$$
      \text{rentabilit√©} = \frac{\text{r√©sultat d'exploitation}}{\text{chiffres d‚Äôaffaires nets}}
$$

\medskip

Table: Classification des entreprises selon leur rentabilit√©

| Intervalle de rentabilit√© | Cat√©gorie |
|---------------------------|-----------|
| Rentabilit√© $< 0$         | En perte  |
| $0 \leq$ Rentabilit√© $< 0{,}1$ | Faible rentabilit√© |
| $0{,}1 \leq$ Rentabilit√© $< 0{,}3$ | Rentabilit√© moyenne |
| Rentabilit√© $\geq 0{,}3$  | Haute rentabilit√© |

\medskip

````{r rentabilite,eval=TRUE, echo=FALSE,message=FALSE,warning=FALSE,fig.width=5}


# filtre non numerique
data_pie <- data_subset %>%
  filter(categorie_rentabilite != "Non num√©rique") %>%
  group_by(year, categorie_rentabilite) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(year) %>%
  mutate(percentage = count / sum(count) * 100)

# dessiner camembert 
ggplot(data_pie, aes(x = "", y = percentage, fill = categorie_rentabilite)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  facet_wrap(~ year) +
  labs(
    title = "R√©partition des cat√©gories de rentabilit√© par ann√©e",
    fill = NULL
  ) +
  theme_void() +
  theme(
    legend.position = "bottom",
    legend.text = element_text(size = 9),
    plot.title = element_text(hjust = 0.5, size = 14)
  ) +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE))



````

\newpage 

### Analyse Univarie

\medskip

#### Chifre d'afffaire

```{r chiffre_affaire_summary_2015, echo=FALSE, message=FALSE, warning=FALSE ,fig.width=4, fig.height=3}

library(dplyr)
library(kableExtra)

# filtre 2015
summary_ca <- data_subset %>%
  filter(!is.na(region), year == 2015) %>%
  group_by(region) %>%
  summarise(
    avarage = mean(ca, na.rm = TRUE),
    median = median(ca, na.rm = TRUE),
    min = min(ca, na.rm = TRUE),
    max = max(ca, na.rm = TRUE),
    ecart_type = sd(ca, na.rm = TRUE),
    .groups = "drop"
  )

# million pour pdf
summary_ca_fmt <- summary_ca %>%
  mutate(across(c(avarage, median, min, max, ecart_type), ~ round(. / 1e6, 2)))

# latex tableau
summary_ca_fmt %>%
  kable(format = "latex", booktabs = TRUE, longtable = TRUE,
        caption = "R√©sum√© des statistiques du chiffre d'affaires nets (en millions d'euros) ‚Äì 2015") %>%
  kable_styling(latex_options = c("scale_down", "repeat_header"))


# write_csv(summary_ca, "summary_chiffre_affaires_2015.csv")

```




````{r chiffre_affaire_graph_2015, echo=FALSE, message=FALSE, warning=FALSE,fig.width=4, fig.height=3}
library(ggplot2)

#Boxplot  Chiffre d'affaires (2015, max y = 4000)

ggplot(data_subset %>% filter(year == 2015, !is.na(region)),
       aes(x = region, y = ca / 1e6)) +
  geom_boxplot(outlier.color = "red") +
  coord_flip() +
  ylim(0, 3000) +  # Y max 3000
  labs(title = "Boxplot du chiffre d'affaires par r√©gion (2015)",
       y = "Chiffre d'affaires nets (millions euro)", x = "R√©gion") +
  theme_minimal(base_size = 9)







````


\newpage 


#### Resultat d'Explation 

````{r resultat_exp_summary_2015, echo=FALSE, message=FALSE, warning=FALSE}
# R√©sultat d'exploitation (resultat_exp) pour tableu
summary_resultat <- data_subset %>%
  filter(!is.na(region), year == 2015) %>%
  group_by(region) %>%
  summarise(
    avarage = mean(resultat_exp, na.rm = TRUE),
    median = median(resultat_exp, na.rm = TRUE),
    min = min(resultat_exp, na.rm = TRUE),
    max = max(resultat_exp, na.rm = TRUE),
    ecart_type = sd(resultat_exp, na.rm = TRUE),
    .groups = "drop"
  )

#print(summary_resultat)
# write_csv(summary_resultat, "summary_resultat_exploitation_by_year_region.csv")



# PDF million 
summary_Res_fmt <- summary_resultat %>%
  mutate(across(c(avarage, median, min, max, ecart_type), ~ round(. / 1e6, 2)))

# latex tableur sinon bordel qsdqsdqsdqsd
summary_ca_fmt %>%
  kable(format = "latex", booktabs = TRUE, longtable = TRUE,
        caption = "R√©sum√© des statistiques du R√©sultat d'exploitation (en millions d'euros) ‚Äì 2015") %>%
  kable_styling(latex_options = c("scale_down", "repeat_header"))

#write_csv(summary_table,"csv/summary_test.csv")
#View(summary_table)
#print(summary_table)






````



````{r resulta_graph_2015, echo=FALSE, message=FALSE, warning=FALSE,fig.width=4, fig.height=3}

library(ggplot2)

# Boxplot ‚Äì Chiffre d'affaires (2015, max y = 4000)
ggplot(data_subset %>% filter(year == 2015, !is.na(region)), 
       aes(x = region, y = resultat_exp / 1e6)) +
  geom_boxplot(outlier.color = "red") +
  coord_flip() +
  ylim(0, 1500) +  # Y max 4000
  labs(title = "Boxplot du R√©sultat d'exploitation par r√©gion (2015)",
       y = "R√©sultat d'exploitation (millions euro)", x = "R√©gion") +
  theme_minimal(base_size = 9)



````



\newpage

### Analyse Bivarie
 \medskip
 
#### Chiffre d‚Äôaffaires nets et R√©sultat d'exploitation
 
````{r nuage_point_anness,eval=TRUE, echo=FALSE,message=FALSE, warning=FALSE,fig.width=5, fig.height=3}
ggplot(data_subset, aes(x = ca/1e6, y = resultat_exp/1e6)) +
  geom_point(alpha = 0.4, color = "darkred") +
  facet_wrap(~year) +
  labs(
    title = "Relation entre Chiffre d'affaires et R√©sultat d'exploitation",
    x = "Chiffre d'affaires (millions euro)",
    y = "R√©sultat d'exploitation (millions euro)"
  ) +
  theme_minimal()

````

#### Coefficient de corr√©lation de Pearson
 
\medskip

````{r correlation_annee, eval=TRUE, echo=FALSE,message=FALSE, warning=FALSE,fig.width=5, fig.height=3}

for (yr in unique(data_subset$year)) {
  df_year <- data_subset %>% filter(year == yr)
  cor_val <- cor(df_year$ca, df_year$resultat_exp, use = "complete.obs", method = "pearson")
  #print(paste("Ann√©e", yr, ": corr√©lation =", round(cor_val, 3)))
}


````


| Ann√©e  | Corr√©lation (Pearson)  | Interpr√©tation  |
|--------|---|---|
|2012|-0.45    |Corr√©lation n√©gative mod√©r√©e   |
|2013|0.35     |Relation positive mod√©r√©e   |
|2014|0.80     |Forte corr√©lation positive    |
|2015|0.38     |Tendance positive similaire √† 2013   |
|2016|0.29     |Corr√©lation positive mais faible   |

\medskip


La corr√©lation doit √™tre comprise entre **-1 et 1**, donc les valeurs que nous avons trouv√©es sont correctes.
On peut dire qu'en 2012, il existe une relation **n√©gative** entre les deux variables.
Pour les ann√©es 2013, 2015 et 2016, la corr√©lation est **faible mais positive** : cela signifie que lorsque le chiffre d'affaires augmente, le r√©sultat d'exploitation a tendance √† augmenter √©galement.
En 2014, on observe une **forte** corr√©lation positive, ce qui indique une relation claire entre les deux variables : elles ont tendance √† √©voluer dans le m√™me sens, c‚Äôest-√†-dire √† augmenter en m√™me temps.


\newpage

#### Regreation droit


````{r reg_droit,eval= TRUE, echo=FALSE, message=FALSE,warning=FALSE,fig.width=5, fig.height=3}
ggplot(data_subset, aes(x = ca/1e6, y = resultat_exp/1e6)) +
  geom_point(alpha = 0.3, color = "brown") +
  geom_smooth(method = "lm", color = "blue") +
  facet_wrap(~year) +
  labs(title = "R√©gression lin√©aire entre CA et R√©sultat d'exploitation",
       x = "Chiffre d'affaires (millions euro)", y = "R√©sultat (millions euro)") +
  theme_minimal()


````

\medskip

**Formuler les hypoth√®ses :**

\bigskip

- Hypoth√®se nulle (H\textsubscript{0}) : La r√©partition du chiffre d‚Äôaffaires net et du r√©sultat d'exploitation ne varie pas selon les r√©gions.
\medskip
- Hypoth√®se alternative (H\textsubscript{1}) : Il existe une diff√©rence significative du chiffre d‚Äôaffaires net et du r√©sultat d'exploitation entre les r√©gions.



```{r, eval=TRUE,echo=FALSE}
years <- unique(data_subset$year)


# trigger liste
ca_anova_resume <- list()

for (yr in years) {
  df_year <- data_subset %>%
    filter(year == yr, !is.na(ca), !is.na(region))

  df_year$region <- as.factor(df_year$region)
  model <- aov(ca ~ region, data = df_year)
  s <- summary(model)

  # F et P value
  row <- s[[1]][1, c("F value", "Pr(>F)")]
  f_val <- round(row[[1]], 2)
  p_val <- formatC(row[[2]], format = "f", digits = 9)  # P deƒüeri 4 haneli
  decision <- ifelse(p_val < 0.05, "H0 rejet√©e", "H0 non rejet√©e")

  ca_anova_resume[[as.character(yr)]] <- data.frame(
    Annee = yr,
    F_value = f_val,
    p_value = p_val,
    Decision = decision
  )
}

# merging liste
ca_anova_resume <- do.call(rbind, ca_anova_resume)

# afficer resume 

ca_anova_resume

```

\bigskip


```{r ,eval= TRUE,echo = FALSE}
# startin gliste
resultat_anova_resume <- list()

for (yr in years) {
  df_year <- data_subset %>%
    filter(year == yr, !is.na(resultat_exp), !is.na(region))

  df_year$region <- as.factor(df_year$region)
  model <- aov(resultat_exp ~ region, data = df_year)
  s <- summary(model)

  # F et P value
  row <- s[[1]][1, c("F value", "Pr(>F)")]
  f_val <- round(row[[1]], 2)
  p_val <- formatC(row[[2]], format = "f", digits = 4)  # P deƒüeri 4 haneli
  decision <- ifelse(as.numeric(p_val) < 0.05, "H0 rejet√©e", "H0 non rejet√©e")

  resultat_anova_resume[[as.character(yr)]] <- data.frame(
    Annee = yr,
    F_value = f_val,
    p_value = p_val,
    Decision = decision
  )
}

# merging liste
resultat_anova_resume <- do.call(rbind, resultat_anova_resume)

# afficer resume
print(resultat_anova_resume)


```

#### Conclusion


once upon a time in montpellier....



\newpage





## **Comparer  des Chiffres d‚Äôaffaires net et Imp√¥ts, taxes et versements assimil√©s**
<!-- Hazem IBNMTAR -->
\medskip

Filtrer les valeurs strictement positives

\medskip

\scriptsize
````{r eval=TRUE,echo=FALSE, message=FALSE, warning=FALSE,fig.width=5, fig.height=4}
ca_nets_pos <- data_kaggle$`Chiffres d‚Äôaffaires nets`
summary(ca_nets_pos,na.rm = TRUE)

````
\normalsize

\medskip

Minimum n√©gatif (-32,2 M euro) : incoh√©rent √©conomiquement, un chiffre d'affaires ne peut pas √™tre n√©gatif.
Ces donn√©es devraient √™tre examin√©es, voire exclues pour les analyses statistiques et graphiques.
Moyenne (5,66 M euro) bien sup√©rieure √† la m√©diane (452 565 euro) :
Cela indique une distribution fortement asym√©trique √† droite, caus√©e par des valeurs extr√™mes tr√®s √©lev√©es (entreprises g√©antes).
1er et 3e quartile (Q1 = 123 754 euro ; Q3 = 1 522 934 euro) :
50 % des entreprises ont un CA net compris entre ces deux valeurs,
ce qui refl√®te une forte concentration autour de la petite et moyenne entreprise.
Maximum (7,44 milliards euro) : tr√®s √©lev√©, refl√©tant une extr√™me h√©t√©rog√©n√©it√© dans la taille des entreprises.
Ce type de valeur influence fortement la moyenne (effet des outliers).
Nombre de valeurs manquantes : 12 756 ‚Üí √† prendre en compte dans les analyses (traitement ou imputation).

\medskip


````{r eval=TRUE,echo=FALSE, message=FALSE, warning=FALSE,fig.width=5, fig.height=4}
hist(
  log10(data_kaggle$`Chiffres d‚Äôaffaires nets`[data_kaggle$`Chiffres d‚Äôaffaires nets` > 0]),
  breaks = 100,
  main = "Distribution du chiffre d'affaires net ",
  xlab = "Chiffre d'affaires net en euros",
  col = "darkgreen",
  border = "white"
)


````

\medskip


On peut remarquer que la fr√©quence est particuli√®rement √©lev√©e pour le chiffre d'affaires correspondant √† la valeur 7 sur l‚Äô√©chelle logarithmique, ce qui √©quivaut √† 10^7, soit 10 000 000 euros. 

\medskip

Cela indique que de nombreuses entreprises d√©clarent un chiffre d‚Äôaffaires autour de 10 millions d‚Äôeuros, ce qui montre l‚Äôimportance de cette valeur dans la distribution de cette variable quantitative continue. 

\medskip

Cette concentration justifie une attention particuli√®re dans l‚Äôanalyse √©conomique du dataset.

\medskip

Cr√©er un boxplot en √©chelle log10

\medskip

````{r eval=TRUE,echo=FALSE, message=FALSE, warning=FALSE,fig.width=5, fig.height=4}
boxplot(
  log10(data_kaggle$`Chiffres d‚Äôaffaires nets`[data_kaggle$`Chiffres d‚Äôaffaires nets` > 0]),
  main = "Boxplot du chiffre d'affaires net ",
  ylab = "Chiffre d'affaires net en euros",
  col = "skyblue",
  border = "darkblue"
)

````

\medskip

````{r eval=TRUE,echo=FALSE, message=FALSE, warning=FALSE,fig.width=5, fig.height=4}
# Filtrer les valeurs strictement positives
taxes_pos <- data_kaggle$`Imp√¥ts, taxes et versements assimil√©s`
summary(taxes_pos)
# R√©sultat : 99212
# Histogramme log10 des imp√¥ts, taxes et versements assimil√©s
hist(
  log10(data_kaggle$`Imp√¥ts, taxes et versements assimil√©s`[data_kaggle$`Imp√¥ts, taxes et versements assimil√©s` > 0]),
  breaks = 100,
  main = "Distribution des imp√¥ts, taxes et versements assimil√©s ",
  xlab = "Imp√¥ts, taxes et versements assimil√©s en euros",
  col = "darkred",
  border = "white"
)


````



\medskip

#### Chiffres d'affaires nets

\medskip

Pour le chiffres d'affaires on a gard√© uniquement les valeurs strictement positives .La moyenne est √©leves c'est pour √ßa on peut conclure que il y a des grandes entreprises dans notre base de donn√©es
La m√©diane est plus faible que la moyenne montre que la distribution est asym√©trique.
L'√©cart type est tr√®s grand refl√©tant une forte h√©t√©rog√©nit√©

\medskip
#### Impots:

\medskip

\scriptsize
````{r eval=TRUE,echo=FALSE, message=FALSE, warning=FALSE,fig.width=5, fig.height=4}
summary(ca_nets_pos,na.rm = TRUE)

````

\normalsize

Apr√®s avoir r√©alis√© l'histogramme de la variable quantitative continue "Imp√¥ts, taxes et versements assimil√©s" (en euros), nous avons appliqu√© une √©chelle logarithmique afin d'am√©liorer la lisibilit√© du graphique et de faciliter l‚Äôinterpr√©tation des donn√©es.
On observe alors que la fr√©quence la plus √©lev√©e correspond √† la valeur 4 sur l‚Äô√©chelle logarithmique, ce qui √©quivaut √† 10^4, soit 40 000 euros.Cela signifie qu‚Äôun grand nombre d‚Äôentreprises d√©clarent environ 40 000 euros au titre des imp√¥ts, taxes et versements assimil√©s.


### Test de Correlation

\medskip

````{r graphe_hazem,eval=TRUE , echo=FALSE, warning=FALSE, message=FALSE,fig.width=5, fig.heigth= 5}

library(ggplot2)

# CSV'yi oku
data_kaggle <- read.csv("csv/data_kaggle.csv")

# Filtrage : √©viter log(0)
valid_data <- data_kaggle[
  data_kaggle$Chiffres.d.affaires.nets > 0 &
    data_kaggle$Imp√¥ts..taxes.et.versements.assimil√©s > 0,
]

ca <- valid_data$Chiffres.d.affaires.nets
imp <- valid_data$Imp√¥ts..taxes.et.versements.assimil√©s

# Nuage de points
ggplot(valid_data, aes(
  x = ca,
  y = imp)
) +
  geom_point(color = "blue", alpha = 0.7) +
  scale_x_log10() +
  scale_y_log10() +
  labs(
    title = paste(strwrap("Nuage de points entre les chiffres d'affaire nets et les imp√¥ts, taxes et versements assimil√©s (√©chelle log)", width = 40), collapse = "\n"),
    x = "Chiffres d'affaires nets (log)",
    y = "Imp√¥ts, taxes et versements assimil√©s (log)"
  ) +
  theme(
     plot.title = element_text(hjust = 0.5, face = "bold"),
     axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Corr√©lation log-log
cor(
  log(valid_data$Chiffres.d.affaires.nets),
  log(valid_data$Imp√¥ts..taxes.et.versements.assimil√©s),
  use = "complete.obs"
)


````

\medskip

Apr√®s avoir fait le d√©copage de la base de donn√©es pour la manipuler plus facilement maintenat on va faire le test de corr√©lation avec le nuage de points entre les deux variables rentabilit√© et Impots , taxes et versements assimil√©s :

\medskip
#### Test de corr√©lation entre les chiffres d'affaires nets et l'impots,taxes

\medskip

On souhaiterai savoir le lien entre deux variables dans notre BD (test de cor√©lation).On a trouv√© que $r(xy)=0.8116802$

\medskip


**Hypothese:**  Chiffres d'affaires nets et Impots,taxes  sont non corr√©l√©es lin√©airement

\medskip

````{r,eval=TRUE,echo=TRUE}
n <- 27016
alpha <- 0.05
quant <- qnorm(1 - alpha / 2)
quant
test <- quant / sqrt(n - 1)
test


#R>test
````

\medskip

On peut affirmer qu'il existe une corr√©lation lin√©aire entre la variale chiffres d'affaires nets et la taxe.

D'apr√®s le test de corr√©laion et le nuage de points on peut affirmer que le test et le nuage de points sont compatible donc il existe un nlien entre les deux variables.(Corr√©lation positive forte )

































# Discussion

Placer les r√©sultats que vous avez obtenus dans le chapitre pr√©c√©dent en perspective par rapport au probl√®me √©tudi√©.

# Conclusion et perspectives {.label:ccl}

Quelles sont les conclusions principales? Quelles sont vos recommandations pour le commanditaire? Quelles analyses subs√©quentes pourraient √™tre faites dans le futur?

\bigskip

On attend de vous deux types de perspectives : des perspectives √† court terme pour am√©liorer rapidement votre approche et des perspectives √† plus long terme qu'elles soient li√©es √† la science des donn√©es ou au domaine m√©tier pour lequel vous avez travaill√©.

\bigskip

Lister √©galement les difficult√©s rencontr√©es dans la partie BD (e.g., taille de la base, manque de donn√©es, ...) et dans la partie statistique.

# Bibliographie {-}

<div id="refs"></div>

\bibliographystyle{elsarticle-harv}
\bibliography{references}

# Annexes {-}


Il faut utiliser les annexes de fa√ßon judicieuse. C'est ici que l'on place des r√©sultats trop volumineux pour appara√Ætre dans le corps du rapport. Ou bien des r√©sultats (e.g., graphiques) moins int√©ressants que les autres. Cela permet de limiter le nombre de pages du coeur du rapport, et d'ajouter des d√©tails dans cette partie pour le lecteur d√©sireux d'en savoir plus.

## **Codes** {-}

\tiny
Code utilise pour sciliging
\label{codeR_slicing}
```{r codeR_slicing, eval=FALSE,echo=TRUE}


#Charger la biblioth√®que
library(readr)

#Lire le fichier CSV
data_kaggle <- read_csv("csv/data_kaggle.csv")

#Fonction pour calculer la rentabilit√© (PAS de r√©f√©rence directe √† data_kaggle dans les param√®tres)
fonction_rentabilite <- function(resultat_financier, ca_net) {
  if (!is.na(resultat_financier) && !is.na(ca_net) && ca_net != 0) {
    return(resultat_financier / ca_net)
  } else {
    return(NA)
  }
}

#Appliquer la fonction ligne par ligne
data_kaggle$rentabilite <- apply(data_kaggle, 1, function(row) {
  resultat <- as.numeric(row["R√©sultat financier"])
  ca <- as.numeric(row["Chiffres d'affaires nets"])
  return(fonction_rentabilite(resultat, ca))
})

#Sauvegarder le r√©sultat dans un nouveau fichier CSV
write.csv(data_kaggle, 
          "csv/data_kaggle_new.csv", 
          row.names = FALSE)

#Affichage pour v√©rification
View(data_kaggle)
data_kaggle$rentabilite()
annee_2012<-data_kaggle$year[]
annee_2012


install.packages("sqldf")
library(sqldf)

result <- sqldf("SELECT * FROM data_kaggle WHERE year = 2012")
result
head(result)
annee_2012<-sqldf("SELECT* from data_kaggle WHERE year=2012")
View(annee_2012)
annee_2013<-sqldf("SELECT* from data_kaggle WHERE year=2013")
annee_2014<-sqldf("SELECT* from data_kaggle WHERE year=2014")
annee_2015<-sqldf("SELECT* from data_kaggle WHERE year=2015")
annee_2016<-sqldf("SELECT* from data_kaggle WHERE year=2016")
cor(annee_2012$rentabilite,annee_2012$`Imp√¥ts, taxes et versements assimil√©s`,use = "complete.obs")
plot(annee_2012$rentabilite,annee_2012$`Imp√¥ts, taxes et versements assimil√©s`)
# Table 1 : Soci√©t√©
# Combinaison des 100 premi√®res lignes de chaque sous-ensemble
sous_ensemble <- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)
View(sous_ensemble)

# S√©lection des colonnes souhait√©es
societe <- sous_ensemble[, c("siren", "denomination", "postal_code", "town", "ape")]
View(societe)
write_csv(societe, "csv/societe.csv")

# Table 2 : Subventions
sous_ensemble_2 <- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)
subventions<-sous_ensemble_2[, c("year","siren", "Subventions d‚Äôexploitation")]


write_csv(subventions, "csv/subvention.csv")

# Table 3 : ApeGen
sous_ensemble_3 <- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)


apegen<-sous_ensemble_3[, c("ape", "ape_name", "ape_len", "ape_division", "ape_groupe", "ape_classe", "ape_sous_classe")]
write_csv(apegen, "csv/apegen.csv")

# Table 4 : Chiffre d'Affaires
sous_ensemble_4<- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)
chiffre_affaire<-sous_ensemble_4[,c("siren", "Chiffres d'affaires nets", "Imp√¥ts, taxes et versements assimil√©s")]

write_csv(chiffre_affaire, "csv/chiffre_affaire.csv")

# Table 5 : Charges Chiffre
sous_ensemble_5<- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)
charge_chiffre <- sous_ensemble_5[, c("year",
  "siren", 
  "Reprises sur amortissements et provisions, transfert de charges", 
  "Reprises sur provisions et transferts de charges financier", 
  "Reprises sur provisions et transferts de charges exceptionnel", 
  "Achats de marchandises (y compris droits de douane)", 
  "Achats de mati√®res premi√®res et autres approvisionnements", 
  "Autres achats et charges externes", 
  "Salaires et traitements", 
  "Charges sociales"
)]
write_csv(charge_chiffre, "csv/charge_chiffre.csv")

# Table 6 : Produits Chiffre
sous_ensemble_6<- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)


produit_chiffre <- sous_ensemble_6[, c("year",
  "siren", 
  "Total des produits d‚Äôexploitation", 
  "Total des produits financiers", 
  "Total des produits exceptionnels", 
  "Autres produits"
)]
write_csv(produit_chiffre, "csv/produit_chiffre.csv")
# Table 7 : Compte de R√©sultat
sous_ensemble_7<- rbind(
  annee_2012[1:100, ],
  annee_2013[1:100, ],
  annee_2014[1:100, ],
  annee_2015[1:100, ],
  annee_2016[1:100, ]
)

compte_resultat <- sous_ensemble_7[, c("year",
  "siren", 
  "Chiffres d'affaires nets", 
  "Imp√¥ts, taxes et versements assimil√©s", 
  "R√©sultat d'exploitation", 
  "R√©sultat financier", 
  "R√©sultat en cours avant imp√¥ts", 
  "R√©sultat exceptionnel", 
  "B√©n√©fices ou perte (Total des produits ‚Äê Total des charges)"
)]
write_csv(compte_resultat, "csv/compte_resultat.csv")
stock <- sous_ensemble_7[ c("year")]
write_csv(stock, "csv/stock.csv")

```
\normalsize



## **Tables** {-}

Si vous avez des tableaux suppl√©mentaires, vous pouvez les ajouter ici.

Utiliser https://www.tablesgenerator.com/markdown_tables pour cr√©er des tables Markdown simples, ou bien utiliser \LaTeX.

| Les tables   |        sont       |  cool |
|--------------|:-----------------:|------:|
| col 1 est    |  align√©e √† gauche | $1600 |
| col 2 est    |     centr√©e       |   $12 |
| col 3 est    | align√©e √† droite  |    $1 |

Table: une l√©gende au-dessus du tableau. \label{tab7.1}

Aligner les nombres de la troisi√®me colonne sur la droite permet d'afficher les unit√©s au-dessus des unit√©s, les dizaines au-dessus des dizaines, etc. Il faut toujours privil√©gier cette pr√©sentation.

